<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Title of the page with the logo as favicon -->
    <title>Futuristic Chatbot</title>

    <!-- Link to the favicon (your logo) -->
    <link rel="icon" href="static/images/logo.png" type="image/png" />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <style>
      body {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: #fff;
        font-family: "Arial", sans-serif;
        overflow: hidden; /* Prevents overflow due to sidebar */
      }

      /* Chat messages take the full width of the screen */
      .chat-container {
        width: 100%;
        height: calc(
          100vh - 120px
        ); /* Full height minus header and input field */
        overflow-y: auto;
        padding: 10px;
        transition: margin-left 0.3s ease; /* Smooth transition for shifting */
      }

      .message {
        margin: 10px 0;
        padding: 10px;
        border-radius: 10px;
        max-width: 80%; /* Limits the message width */
      }

      .user-message {
        background-color: rgba(
          135,
          206,
          250,
          0.5
        ); /* Light blue background for user */
        text-align: right;
        align-self: flex-end;
      }

      .bot-message {
        background-color: rgba(
          255,
          192,
          203,
          0.5
        ); /* Light pink background for responses */
        text-align: left;
        align-self: flex-start;
      }

      .input-group {
        margin-bottom: 50px; /* Added bottom margin */
        transition: margin-left 0.3s, width 0.3s; /* Smooth transition */
        display: flex;
        justify-content: flex-start; /* Align the input and button to the left */
      }

      .input-group input {
        width: auto; /* Input will dynamically resize */
        min-width: 150px; /* Minimum width of input box */
        max-width: 50%; /* Max width to avoid being too long */
        padding-right: 5px;
        margin-left: 330px;
        flex-grow: 1;
        transition: width 0.3s ease-in-out;
      }

      .input-group-append button {
        margin-left: 0px;
      }

      #sidebar {
        position: fixed;
        top: 0;
        left: -300px; /* Hide off-screen */
        width: 300px;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        transition: left 0.3s ease;
        padding: 20px;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
      }

      #sidebar h3 {
        color: #fff;
      }

      #sidebar .close-btn {
        cursor: pointer;
        color: #fff;
        float: right;
        font-size: 1.5em;
      }

      .hamburger {
        cursor: pointer;
        font-size: 1.5em;
        position: absolute;
        top: 80px;
        left: 20px;
      }

      .btn-custom {
        background: linear-gradient(135deg, #f3a683, #f7d794);
        border: none;
        transition: background 0.3s, transform 0.2s;
      }

      .btn-custom:hover {
        background: linear-gradient(135deg, #f7d794, #f3a683);
        transform: scale(1.05);
      }

      /* Logo and Header Styling */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        background-color: rgba(255, 255, 255, 0.2);
        margin-bottom: 10px;
      }

      .header img {
        max-height: 50px;
      }

      .header h1 {
        color: #fff;
        font-size: 1.5em;
      }

      /* Ensures the hamburger icon remains visible and chatbox doesn't overlap */
      .chat-container {
        margin-left: 250px; /* Add margin to ensure the hamburger icon is visible */
        margin-right: 20px;
      }
    </style>
  </head>

  <body>
    <!-- Header with Company Logo -->
    <div class="header">
      <img src="static/images/logo.png" alt="Company Logo" />
      <h1>Futuristic Chatbot</h1>
    </div>

    <!-- Hamburger icon to open sidebar -->
    <div class="hamburger" id="hamburger">&#9776;</div>

    <!-- Full-screen chat container -->
    <div class="chat-container" id="chatbox"></div>

    <!-- Input area -->
    <div class="input-group" id="input_group">
      <input
        type="text"
        id="user_input"
        class="form-control"
        placeholder="Type your message..."
        aria-label="User message"
      />
      <div class="input-group-append">
        <button class="btn btn-custom" id="send_button">Send</button>
      </div>
    </div>

    <!-- Sidebar -->
    <div id="sidebar">
      <h3>
        Chat History <span class="close-btn" id="close_sidebar">&times;</span>
      </h3>
      <div id="history_content"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
      let chatHistory = [];

      $(document).ready(function () {
        // Adjust input box width dynamically
        $("#user_input").on("input", function () {
          let inputLength = this.value.length;
          this.style.width =
            Math.min(inputLength * 8 + 50, window.innerWidth / 2) + "px"; // Adjust width based on text length, with a max width
        });

        $("#send_button").click(function () {
          let userMessage = $("#user_input").val();
          if (userMessage.trim() === "") return;

          // Add to chat history
          chatHistory.push({ role: "user", content: userMessage });
          $("#chatbox").append(
            `<div class="message user-message">${userMessage}</div>`
          );
          $("#user_input").val("");
          $("#user_input").css("width", "auto"); // Reset the width after sending

          $.ajax({
            url: "/send_message",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ message: userMessage }),
            success: function (response) {
              chatHistory.push({ role: "bot", content: response.bot_response });
              $("#chatbox").append(
                `<div class="message bot-message">${response.bot_response}</div>`
              );
              $("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
            },
            error: function () {
              $("#chatbox").append(
                `<div class="message bot-message">Sorry, there was an error processing your request.</div>`
              );
              $("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
            },
          });
        });

        // Toggle history sidebar
        $("#hamburger").click(function () {
          $("#sidebar").css("left", "0"); // Show sidebar
          $(".chat-container").css("margin-left", "300px"); // Shift chat area to the right
          $("#input_group").css("margin-left", "300px"); // Shift input area to the right
          displayHistory();
        });

        $("#close_sidebar").click(function () {
          $("#sidebar").css("left", "-300px"); // Hide sidebar
          $(".chat-container").css("margin-left", "50px"); // Reset chat area position (ensure hamburger is visible)
          $("#input_group").css("margin-left", "0"); // Reset input area position
        });

        // Allow Enter key to send message
        $("#user_input").keypress(function (e) {
          if (e.which == 13) {
            $("#send_button").click();
            return false; // Prevent form submission
          }
        });
      });

      // Function to display chat history in the sidebar
      function displayHistory() {
        $("#history_content").empty();
        chatHistory.forEach((message) => {
          $("#history_content").append(
            `<div class="message ${message.role}-message">${message.content}</div>`
          );
        });
      }
    </script>
  </body>
</html>
