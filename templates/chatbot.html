<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Title of the page with the logo as favicon -->
    <title>Futuristic Chatbot</title>

    <!-- Link to the external Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <!-- Link to the external CSS file -->
    <link rel="stylesheet" href="static/css/styles-chatbot.css" />
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <!-- <a class="navbar-brand" href="{{ url_for('index') }}">NEBULA</a> -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavDropdown"
          aria-controls="navbarNavDropdown"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="{{ url_for('index') }}"
                >Home</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#features">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Pricing</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdownMenuLink"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                More
              </a>
              <ul
                class="dropdown-menu"
                aria-labelledby="navbarDropdownMenuLink"
              >
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header with Company Logo -->
    <div class="header">
      <!-- <img src="static/images/logo.png" alt="Company Logo" /> -->
      <!-- <h1>NEBULA</h1> -->
    </div>

    <!-- Hamburger icon to open sidebar -->
    <!-- <div class="hamburger" id="hamburger">&#9776;</div> -->

    <!-- Full-screen chat container -->
    <div class="chat-container" id="chatbox"></div>

    <!-- Input area -->
    <div class="input-group" id="input_group">
      <input
        type="text"
        id="user_input"
        class="form-control"
        placeholder="Type your message..."
        aria-label="User message"
      />
      <div class="input-group-append">
        <button class="btn btn-custom" id="send_button">Send</button>
      </div>
    </div>

    <!-- Sidebar -->
    <!-- <div id="sidebar"> -->
    <!-- <h3>NEBULA <span class="close-btn" id="close_sidebar">&times;</span></h3> -->
    <!-- <div id="history_content"></div>
    </div> -->

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
      // Existing JavaScript remains unchanged
      let chatHistory = [];

      $(document).ready(function () {
        // Adjust input box width dynamically
        $("#user_input").on("input", function () {
          let inputLength = this.value.length;
          this.style.width =
            Math.min(inputLength * 8 + 50, window.innerWidth / 2) + "px";
        });

        $("#send_button").click(function () {
          let userMessage = $("#user_input").val();
          if (userMessage.trim() === "") return;

          chatHistory.push({ role: "user", content: userMessage });
          $("#chatbox").append(
            `<div class="message user-message">${userMessage}</div>`
          );
          $("#user_input").val("");
          $("#user_input").css("width", "auto");

          $.ajax({
            url: "/send_message",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ message: userMessage }),
            success: function (response) {
              chatHistory.push({ role: "bot", content: response.bot_response });
              $("#chatbox").append(
                `<div class="message bot-message">${response.bot_response}</div>`
              );
              $("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
            },
            error: function () {
              $("#chatbox").append(
                `<div class="message bot-message">Sorry, there was an error processing your request.</div>`
              );
              $("#chatbox").scrollTop($("#chatbox")[0].scrollHeight);
            },
          });
        });

        $("#hamburger").click(function () {
          $("#sidebar").css("left", "0");
          $(".chat-container").css("margin-left", "300px");
          $("#input_group").css("margin-left", "300px");
          displayHistory();
        });

        $("#close_sidebar").click(function () {
          $("#sidebar").css("left", "-300px");
          $(".chat-container").css("margin-left", "50px");
          $("#input_group").css("margin-left", "0");
        });

        $("#user_input").keypress(function (e) {
          if (e.which == 13) {
            $("#send_button").click();
            return false;
          }
        });
      });

      function displayHistory() {
        $("#history_content").empty();
        chatHistory.forEach((message) => {
          $("#history_content").append(
            `<div class="message ${message.role}-message">${message.content}</div>`
          );
        });
      }
    </script>
  </body>
</html>
